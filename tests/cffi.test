# (c) 2021 Ashok P. Nadkarni
# See LICENSE for license terms.
#
# This file contains tests for all cffi::dyncall::Library functionality except the
# function method which has its own file

source [file join [file dirname [info script]] common.tcl]

# Library tests
namespace eval ${NS}::test {
    test version-0 {Version check} -body {
        uplevel #0 package require cffi
    } -result 1.0b2

    test pkgconfig-list-0 {pkgconfig list} -body {
        lsort [cffi::pkgconfig list]
    } -result {backend compiler version}
    test pkgconfig-get-0 {pkgconfig get version} -body {
        cffi::pkgconfig get version
    } -result [uplevel #0 package require cffi]
    test pkgconfig-get-1 {pkgconfig get compiler} -body {
        catch {cffi::pkgconfig get compiler}
    } -result 0
    test pkgconfig-get-2 {pkgconfig get backend} -body {
        expr {[cffi::pkgconfig get backend] in {libffi dyncall}}
    } -result 1

}

::tcltest::cleanupTests
namespace delete cffi::test
